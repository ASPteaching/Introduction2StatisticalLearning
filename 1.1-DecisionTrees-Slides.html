<!DOCTYPE html>
<html lang="en"><head>
<script src="1.1-DecisionTrees-Slides_files/libs/clipboard/clipboard.min.js"></script>
<script src="1.1-DecisionTrees-Slides_files/libs/quarto-html/tabby.min.js"></script>
<script src="1.1-DecisionTrees-Slides_files/libs/quarto-html/popper.min.js"></script>
<script src="1.1-DecisionTrees-Slides_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="1.1-DecisionTrees-Slides_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="1.1-DecisionTrees-Slides_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="1.1-DecisionTrees-Slides_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="1.1-DecisionTrees-Slides_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.4.549">

  <meta name="author" content="Alex Sanchez, Ferran Reverter and Esteban Vegas">
  <title>Tree based methods</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="1.1-DecisionTrees-Slides_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="1.1-DecisionTrees-Slides_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="1.1-DecisionTrees-Slides_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="css4CU.css">
  <link href="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Tree based methods</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alex Sanchez, Ferran Reverter and Esteban Vegas 
</div>
        <p class="quarto-title-affiliation">
            Genetics Microbiology and Statistics Department. University of Barcelona
          </p>
    </div>
</div>

</section>

<section>
<section id="introduction-to-decision-trees" class="title-slide slide level1 center">
<h1>Introduction to Decision Trees</h1>

</section>
<section id="motivation" class="slide level2">
<h2>Motivation</h2>
<ul>
<li>In many real-world applications, decisions need to be made based on complex, multi-dimensional data.</li>
<li>One goal of statistical analysis is to provide insights and guidance to support these decisions.</li>
<li>Decision trees provide a way to organize and summarize information in a way that is easy to understand and use in decision-making.</li>
</ul>
</section>
<section id="examples" class="slide level2">
<h2>Examples</h2>
<ul>
<li><p>A bank needs to have a way to decide if/when a customer can be granted a loan.</p></li>
<li><p>A doctor may need to decide if a patient has to undergo a surgery or a less aggressive treatment.</p></li>
<li><p>A company may need to decide about investing in new technologies or stay with the traditional ones.</p></li>
</ul>
<p>In all those cases a decision tree may provide a structured approach to decision-making that is based on data and can be easily explained and justified.</p>
</section>
<section id="an-intuitive-approach" class="slide level2">
<h2>An intuitive approach</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Decisions are often based on asking several questions on available information whose answers induce binary splits on data that end up with some grouping or classification.</p>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/decTree4HypertensionNew.png" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
<figcaption>A doctor may classify patients at high or low cardiovascular risk using some type of decision tree</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="so-what-is-a-decision-tree" class="slide level2">
<h2>So, what is a decision tree?</h2>
<ul>
<li><p>A decision tree is a graphical representation of a series of decisions and their potential outcomes.</p></li>
<li><p>It is obtained by recursively <em>stratifying</em> or <em>segmenting</em> the <em>feature space</em> into a number of simple regions.</p></li>
<li><p>Each region (decision) corresponds to a <em>node</em> in the tree, and each potential outcome to a <em>branch</em>.</p></li>
<li><p>The tree structure can be used to guide decision-making based on data.</p></li>
</ul>
<!-- ## A first look at pros and cons   (CREC QUE NO CAL)(-->
<!-- -   Trees provide an simple approach to classification and prediction for both categorical or numerical outcomes. -->
<!-- -   The results are intuitive and easy to explain and interpret. -->
<!-- -   They are, however, not very accurate, but -->
<!-- -   Aggregation of multiple trees built on the same data can result on dramatic improvements in prediction accuracy, at the expense of some loss of interpretation. -->
</section>
<section id="what-do-we-need-to-learn" class="slide level2">
<h2>What do we need to learn?</h2>
<ul>
<li><p>We need <strong>context</strong>:</p>
<ul>
<li><p>When is it appropriate to rely on decision trees?</p></li>
<li><p>When would other approaches be preferable?</p></li>
<li><p>What type of decision trees can be used?</p></li>
</ul></li>
<li><p>We need to know how to <strong>build good trees</strong></p>
<ul>
<li>How do we <em>construct</em> a tree?</li>
<li>How do we <em>optimize</em> the tree?</li>
<li>How do we <em>evaluate</em> it?</li>
</ul></li>
</ul>
</section>
<section id="more-about-context" class="slide level2">
<h2>More about context</h2>
<ul>
<li><p>Decision trees are non parametric, data guided predictors, well suited in many situations such as:</p>
<ul>
<li>Non-linear relationships.</li>
<li>High-dimensional data.</li>
<li>Interaction between variables exist.</li>
<li>Mixed data types.</li>
</ul></li>
<li><p>They are not so appropriate for complex datasets, or complex problems, that require expert knowledge.</p></li>
<li><p><a href="https://g.co/gemini/share/781b7d88e03a">See here some examples of each situation!</a></p></li>
</ul>
</section>
<section id="types-of-decision-trees" class="slide level2">
<h2>Types of decision trees</h2>
<ul>
<li><p><strong>Classification Trees</strong> are built when the response variable is categorical.</p>
<ul>
<li>They aim to <em>classify a new observation</em> based on the values of the predictor variables.</li>
</ul></li>
<li><p><strong>Regression Trees</strong> are used when the response variable is numerical.</p>
<ul>
<li>They aim to <em>predict the value</em> of a continuous response variable based on the values of the predictor variables.</li>
</ul></li>
</ul>
</section>
<section id="tree-building-with-r" class="slide level2 smaller">
<h2>Tree building with R</h2>
<p><br></p>
<div class="font90">
<table>
<thead>
<tr class="header">
<th><strong>Package</strong></th>
<th><strong>Algorithm</strong></th>
<th><strong>Dataset size</strong></th>
<th><strong>Missing data handling</strong></th>
<th><strong>Ensemble methods</strong></th>
<th><strong>Visual repr</strong></th>
<th><strong>User interface</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/rpart/index.html"><strong><code>rpart</code></strong></a></td>
<td>RPART</td>
<td>Medium to large</td>
<td>Poor</td>
<td>No</td>
<td>Yes</td>
<td>Simple</td>
</tr>
<tr class="even">
<td><a href="https://topepo.github.io/caret/"><strong><code>caret</code></strong></a></td>
<td>Various</td>
<td>Various</td>
<td>Depends on algorithm</td>
<td>Yes</td>
<td>Depends on algorithm</td>
<td>Complex</td>
</tr>
<tr class="odd">
<td><a href="https://cran.r-project.org/web/packages/tree/index.html"><strong><code>tree</code></strong></a></td>
<td>CART</td>
<td>Small to medium</td>
<td>Poor</td>
<td>No</td>
<td>Yes</td>
<td>Simple</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="tree-building-with-python" class="slide level2">
<h2>Tree building with Python</h2>
<div class="font50">
<table>
<colgroup>
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Package</strong></th>
<th><strong>Algorithm</strong></th>
<th><strong>Dataset size</strong></th>
<th><strong>Missing data handling</strong></th>
<th><strong>Ensemble methods</strong></th>
<th><strong>Visual repr</strong></th>
<th><strong>User interface</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>scikit-learn</code></strong></td>
<td>CART (DecisionTreeClassifier)</td>
<td>Small to large</td>
<td>Can handle NaN</td>
<td>Yes</td>
<td>Yes (using Graphviz)</td>
<td>Simple</td>
</tr>
<tr class="even">
<td><strong><code>dtreeviz</code></strong></td>
<td>CART (DecisionTree)</td>
<td>Small to large</td>
<td>Can handle NaN</td>
<td>No</td>
<td>Yes</td>
<td>Simple</td>
</tr>
<tr class="odd">
<td><strong><code>xgboost</code></strong></td>
<td>Gradient Boosting</td>
<td>Medium to large</td>
<td>Requires imputation</td>
<td>Yes</td>
<td>No</td>
<td>Complex</td>
</tr>
<tr class="even">
<td><strong><code>lightgbm</code></strong></td>
<td>Gradient Boosting</td>
<td>Medium to large</td>
<td>Requires imputation</td>
<td>Yes</td>
<td>No</td>
<td>Complex</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="starting-with-an-example" class="slide level2">
<h2>Starting with an example</h2>
<ul>
<li>The Pima Indian Diabetes dataset contains 768 individuals (female) and 9 clinical variables.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 768
Columns: 9
$ pregnant &lt;dbl&gt; 6, 1, 8, 1, 0, 5, 3, 10, 2, 8, 4, 10, 10, 1, 5, 7, 0, 7, 1, 1…
$ glucose  &lt;dbl&gt; 148, 85, 183, 89, 137, 116, 78, 115, 197, 125, 110, 168, 139,…
$ pressure &lt;dbl&gt; 72, 66, 64, 66, 40, 74, 50, NA, 70, 96, 92, 74, 80, 60, 72, N…
$ triceps  &lt;dbl&gt; 35, 29, NA, 23, 35, NA, 32, NA, 45, NA, NA, NA, NA, 23, 19, N…
$ insulin  &lt;dbl&gt; NA, NA, NA, 94, 168, NA, 88, NA, 543, NA, NA, NA, NA, 846, 17…
$ mass     &lt;dbl&gt; 33.6, 26.6, 23.3, 28.1, 43.1, 25.6, 31.0, 35.3, 30.5, NA, 37.…
$ pedigree &lt;dbl&gt; 0.627, 0.351, 0.672, 0.167, 2.288, 0.201, 0.248, 0.134, 0.158…
$ age      &lt;dbl&gt; 50, 31, 32, 21, 33, 30, 26, 29, 53, 54, 30, 34, 57, 59, 51, 3…
$ diabetes &lt;fct&gt; pos, neg, pos, neg, pos, neg, pos, neg, pos, pos, neg, pos, n…</code></pre>
</div>
</div>
</section>
<section id="looking-at-the-data" class="slide level2">
<h2>Looking at the data</h2>
<ul>
<li>These Variables are known to be related with cardiovascular diseases.</li>
<li>It seems intuitive to use these variables to decide if a person is affected by diabetes</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>             p0      p25      p50       p75   p100  hist
diabetes     NA       NA       NA        NA     NA  &lt;NA&gt;
pregnant  0.000  1.00000   3.0000   6.00000  17.00 ▇▃▂▁▁
glucose  44.000 99.00000 117.0000 141.00000 199.00 ▁▇▇▃▂
pressure 24.000 64.00000  72.0000  80.00000 122.00 ▁▃▇▂▁
triceps   7.000 22.00000  29.0000  36.00000  99.00 ▆▇▁▁▁
insulin  14.000 76.25000 125.0000 190.00000 846.00 ▇▂▁▁▁
mass     18.200 27.50000  32.3000  36.60000  67.10 ▅▇▃▁▁
pedigree  0.078  0.24375   0.3725   0.62625   2.42 ▇▃▁▁▁
age      21.000 24.00000  29.0000  41.00000  81.00 ▇▃▁▁▁</code></pre>
</div>
</div>
</section>
<section id="predicting-diabetes-onset" class="slide level2">
<h2>Predicting Diabetes onset</h2>
<ul>
<li><p>We wish to predict the probability of individuals in being diabete-positive or negative.</p>
<ul>
<li>We start building a tree with all the variables</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="fu">library</span>(rpart)</span>
<span id="cb3-2"><a href=""></a>model1 <span class="ot">&lt;-</span> <span class="fu">rpart</span>(diabetes <span class="sc">~</span>., <span class="at">data =</span> PimaIndiansDiabetes2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>A simple visualization illustrates how it proceeds</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="fu">plot</span>(model1)</span>
<span id="cb4-2"><a href=""></a><span class="fu">text</span>(model1, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">cex=</span><span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="viewing-the-tree-as-text" class="slide level2">
<h2>Viewing the tree as text</h2>
<div class="font40">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>n= 768 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

  1) root 768 268 neg (0.65104167 0.34895833)  
    2) glucose&lt; 127.5 485  94 neg (0.80618557 0.19381443)  
      4) age&lt; 28.5 271  23 neg (0.91512915 0.08487085) *
      5) age&gt;=28.5 214  71 neg (0.66822430 0.33177570)  
       10) insulin&lt; 142.5 164  48 neg (0.70731707 0.29268293)  
         20) glucose&lt; 96.5 51   4 neg (0.92156863 0.07843137) *
         21) glucose&gt;=96.5 113  44 neg (0.61061947 0.38938053)  
           42) mass&lt; 26.35 19   0 neg (1.00000000 0.00000000) *
           43) mass&gt;=26.35 94  44 neg (0.53191489 0.46808511)  
             86) pregnant&lt; 5.5 49  15 neg (0.69387755 0.30612245)  
              172) age&lt; 34.5 25   2 neg (0.92000000 0.08000000) *
              173) age&gt;=34.5 24  11 pos (0.45833333 0.54166667)  
                346) pressure&gt;=77 10   2 neg (0.80000000 0.20000000) *
                347) pressure&lt; 77 14   3 pos (0.21428571 0.78571429) *
             87) pregnant&gt;=5.5 45  16 pos (0.35555556 0.64444444) *
       11) insulin&gt;=142.5 50  23 neg (0.54000000 0.46000000)  
         22) age&gt;=56.5 12   1 neg (0.91666667 0.08333333) *
         23) age&lt; 56.5 38  16 pos (0.42105263 0.57894737)  
           46) age&gt;=33.5 29  14 neg (0.51724138 0.48275862)  
             92) triceps&gt;=27 22   8 neg (0.63636364 0.36363636) *
             93) triceps&lt; 27 7   1 pos (0.14285714 0.85714286) *
           47) age&lt; 33.5 9   1 pos (0.11111111 0.88888889) *
    3) glucose&gt;=127.5 283 109 pos (0.38515901 0.61484099)  
      6) mass&lt; 29.95 75  24 neg (0.68000000 0.32000000) *
      7) mass&gt;=29.95 208  58 pos (0.27884615 0.72115385)  
       14) glucose&lt; 157.5 116  46 pos (0.39655172 0.60344828)  
         28) age&lt; 30.5 50  23 neg (0.54000000 0.46000000)  
           56) pressure&gt;=73 29  10 neg (0.65517241 0.34482759)  
            112) mass&lt; 41.8 20   4 neg (0.80000000 0.20000000) *
            113) mass&gt;=41.8 9   3 pos (0.33333333 0.66666667) *
           57) pressure&lt; 73 21   8 pos (0.38095238 0.61904762) *
         29) age&gt;=30.5 66  19 pos (0.28787879 0.71212121) *
       15) glucose&gt;=157.5 92  12 pos (0.13043478 0.86956522) *</code></pre>
</div>
</div>
</div>
<div class="small">
<ul>
<li>This representation shows the variables and split values that have been selected by the algorithm.</li>
<li>It can be used to classify (new) individuals following the decisions (splits) from top to bottom.</li>
</ul>
</div>
</section>
<section id="plotting-the-tree-1" class="slide level2">
<h2>Plotting the tree (1)</h2>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="1.1-DecisionTrees-Slides_files/figure-revealjs/unnamed-chunk-7-1.png" style="height:10cm" width="960"></p>
<figcaption>Even without domain expertise the model seems <em>reasonable</em></figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-the-tree-nicer" class="slide level2">
<h2>Plotting the tree (Nicer)</h2>

<img data-src="1.1-DecisionTrees-Slides_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch quarto-figure-center"><p class="caption">The tree plotted with the <code>rpart.plot</code> package.</p><div class="small">
<p>Each node shows: (1) the predicted class (‘neg’ or ‘pos’), (2) the predicted probability, (3) the percentage of observations in the node.</p>
</div>
</section>
<section id="individual-prediction" class="slide level2">
<h2>Individual prediction</h2>
<p>Consider individuals 521 and 562</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>    pregnant glucose pressure triceps insulin mass pedigree age diabetes
521        2      68       70      32      66 25.0    0.187  25      neg
562        0     198       66      32     274 41.3    0.502  28      pos</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>521 562 
neg pos 
Levels: neg pos</code></pre>
</div>
</div>
<ul>
<li><p>If we follow individuals 521 and 562 along the tree, we reach the same prediction.</p></li>
<li><p>The tree provides not only a classification but also an explanation.</p></li>
</ul>
</section>
<section id="how-accurate-is-the-model" class="slide level2">
<h2>How accurate is the model?</h2>
<ul>
<li>It is straightforward to obtain a simple performance measure.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>predicted.classes<span class="ot">&lt;-</span> <span class="fu">predict</span>(model1, PimaIndiansDiabetes2, <span class="st">"class"</span>)</span>
<span id="cb8-2"><a href=""></a><span class="fu">mean</span>(predicted.classes <span class="sc">==</span> PimaIndiansDiabetes2<span class="sc">$</span>diabetes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8294271</code></pre>
</div>
</div>
<ul>
<li><p>The question becomes harder when we go back and ask if <em>we obtained the best possible tree</em>.</p></li>
<li><p>In order to answer this question we must study tree construction in more detail.</p></li>
</ul>
<!-- ## Always use train/test sets! -->
<!-- -   A better strategy is to use train dataset to build the model and a test dataset to check how it works. -->
<!-- ```{r echo=TRUE} -->
<!-- set.seed(123) -->
<!-- ssize <- nrow(PimaIndiansDiabetes2) -->
<!-- propTrain <- 0.8 -->
<!-- training.indices <-sample(1:ssize, floor(ssize*propTrain)) -->
<!-- train.data  <- PimaIndiansDiabetes2[training.indices, ] -->
<!-- test.data <- PimaIndiansDiabetes2[-training.indices, ] -->
<!-- ``` -->
<!-- ## Build on train, Estimate on test -->
<!-- -   First, build the model on the train data  -->
<!-- ```{r echo=TRUE} -->
<!-- model2 <- rpart(diabetes ~., data = train.data) -->
<!-- ``` -->
<!-- - Then check its accuracy on the test data. -->
<!-- ```{r echo=TRUE} -->
<!-- predicted.classes.test<- predict(model2, test.data, "class") -->
<!-- mean(predicted.classes.test == test.data$diabetes) -->
<!-- ``` -->
</section></section>
<section>
<section id="building-classification-trees" class="title-slide slide level1 center">
<h1>Building Classification Trees</h1>

</section>
<section id="building-the-trees" class="slide level2">
<h2>Building the trees</h2>
<ul>
<li><p>As with any model, we aim not only at construting trees.</p></li>
<li><p>We wish to build good trees and, if possible, optimal trees in some sense we decide.</p></li>
<li><p>In order to <strong>build good trees</strong> we must decide</p>
<ul>
<li><p>How to <em>construct</em> a tree?</p></li>
<li><p>How to <em>optimize</em> the tree?</p></li>
<li><p>How to <em>evaluate</em> it?</p></li>
</ul></li>
</ul>
<!-- -   Building the tree requires deciding: -->
<!--     -   how to partition ("split") the space, -->
<!--     -   Which *impurity* measures to use, -->
<!--     -   When to stop splitting -->
<!-- -   Evaluation is similar to other classifiers. -->
<!-- -   Optimization involves deciding: -->
<!--     -   How to *prune* the tree, -->
<!--     -   Which features are most important. -->
<!-- ## Some notation first -->
<!-- -   $\mathbb X$: Space of variables, or *feature space* -->
<!--     -   Usually $\mathbb{X} \subseteq \mathbb{R}^p$ -->
<!--     -   But it can contain numerical/categorical variables. -->
<!-- -   $X\in \mathbb{X}$: Input vector: $X_1, X_2, ..., X_p$. -->
<!-- -   Tree-structured classifiers are constructed by repeated splits of the space X into smaller and smaller subsets, beginning with X itself. -->
<!--     -   That is by *recursive splitting* -->
</section>
<section id="trees-are-supervised-learners" class="slide level2">
<h2>TREES ARE SUPERVISED LEARNERS</h2>
<ul>
<li><p>Classification / Regression: <em>Supervised Learning</em> tasks:</p></li>
<li><p>There is a <em>learning set</em> <span class="math inline">\(\mathcal{L}=\{(\mathbf{X_i,Y_i})\}_{i=1}^n\)</span></p></li>
<li><p>And depending of <span class="math inline">\(\mathbf{Y}\)</span> we have:</p>
<ul>
<li>Classification: <span class="math inline">\(\mathbf{X}\in\mathbb{R}^d,\quad Y\in\{-1,+1\}\)</span></li>
<li>Regression <span class="math inline">\(\mathbf{X}\in\mathbb{R}^d,\quad Y\in\mathbb{R}\)</span>.</li>
</ul></li>
</ul>
</section>
<section id="trees-and-decision-trees" class="slide level2 scrollable">
<h2>TREES AND DECISION TREES</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="font80">
<ol type="1">
<li>A tree is a set of nodes and edges organized in a hierarchical fashion.<br> In contrast to a graph, in a tree there are no loops. <!-- Internal nodes are denoted with circles and terminal nodes with squares. --></li>
</ol>
<p><br></p>
<ol start="2" type="1">
<li>A decision tree is a tree where <em>each split node stores a boolean test function</em> to be applied to the incoming data. <br> Each leaf stores the final answer (predictor)</li>
</ol>
</div>
</div><div class="column" style="width:50%;">
<p><img data-src="images/1.1-DecisionTrees-Slides_insertimage_1.png" alt="Plot title."> <img data-src="images/1.1-DecisionTrees-Slides_insertimage_2.png" alt="Plot title."></p>
</div>
</div>
</section>
<section id="additional-notation" class="slide level2">
<h2>Additional notation</h2>
<ul>
<li><p>A node is denoted by <span class="math inline">\(t\)</span>.</p>
<ul>
<li>The left and right child nodes are denoted by <span class="math inline">\(t_{L}\)</span> and <span class="math inline">\(t_{R}\)</span> respectively.</li>
</ul></li>
<li><p>The collection of all nodes in the tree is denoted <span class="math inline">\(T\)</span></p></li>
<li><p>The collection of all the leaf nodes is denoted <span class="math inline">\(\tilde{T}\)</span></p></li>
<li><p>A split will be denoted by <span class="math inline">\(s\)</span>.</p>
<ul>
<li>The set of all splits is denoted by <span class="math inline">\(S\)</span>.</li>
</ul></li>
</ul>
<!-- ## Summary of terminology -->
</section>
<section id="building-a-tree" class="slide level2">
<h2>Building a tree</h2>
<ul>
<li><p>A binary decision tree is built by defining a series of (recursive) splits on the feature space.</p></li>
<li><p>The splits are decided in such a way that the associated learning task is attained</p>
<ul>
<li>by setting thresholds on the variables values,</li>
<li>that induce paths in the tree,</li>
</ul></li>
<li><p>The ultimate goal of the tree is to be able to use a combination of the splits to accomplish the learning task with as small an error as possible.</p></li>
</ul>
</section>
<section id="trees-partition-the-space" class="slide level2">
<h2>Trees partition the space</h2>
<ul>
<li><p><em>A tree represents a recursive splitting of the space</em>.</p>
<ul>
<li>Every node of interest corresponds to one region in the original space.</li>
<li>Two child nodes occupy two different regions.</li>
<li>Together, yield same region as that of the parent node.</li>
</ul></li>
<li><p>In the end, every leaf node is assigned with a class and a test point is assigned with the class of the leaf node it lands in.</p></li>
</ul>
</section>
<section id="the-tree-represents-the-splitting" class="slide level2">
<h2>The tree represents the splitting</h2>
<div class="r-stack">
<div class="fragment fade-in absolute" style="top: 100px; left: 150px; ">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/splits_nodes_1.png" class="quarto-figure quarto-figure-center" width="800" height="400"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="fragment fade-in absolute" style="top: 100px; left: 150px; ">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/splits_nodes_2.png" class="quarto-figure quarto-figure-center" width="800" height="400"></p>
</figure>
</div>
</div>
</div>
</div>
<div class="fragment fade-in absolute" style="top: 100px; left: 150px; ">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/splits_nodes_3.png" class="quarto-figure quarto-figure-center" width="800" height="400"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<!-- -   [Animation](https://youtu.be/1ow2tF9Ezgs) -->
</section>
<section id="different-splits-are-possible" class="slide level2">
<h2>Different splits are possible</h2>
<ul>
<li>It is always possible to split a space in distinct ways</li>
</ul>

<img data-src="images/1.1-DecisionTrees-Slides_insertimage_3.png" class="quarto-figure quarto-figure-center r-stretch" width="400"><ul>
<li><p>Some ways perform better than other for a given task, but rarely will they be perfect.</p></li>
<li><p>So we aim at combining splits to find a better rule.</p></li>
</ul>
</section>
<section id="construction-of-a-tree" class="slide level2 scrollable">
<h2>Construction of a tree</h2>
<p>Tree building involves the following three elements:</p>
<ol type="1">
<li><p>The selection of the splits, i.e., how do we decide which node (region) to split and how to split it?</p>
<ul>
<li>How to select from the pool of candidate splits?</li>
<li>What are appropriate <em>goodness of split</em> criteria?</li>
</ul></li>
<li><p>If we know how to make splits (‘grow’ the tree), how do we decide when to declare a node terminal and <em>stop splitting</em>?</p></li>
<li><p>How do we assign each terminal node to a class?</p></li>
</ol>
</section>
<section id="tb-1.1---split-selection" class="slide level2">
<h2>TB 1.1 - Split selection</h2>
<ul>
<li><p>To build a Tree, questions have to be generated that induce splits based on the value of a single variable.</p></li>
<li><p>Ordered variable <span class="math inline">\(X_j\)</span>:</p>
<ul>
<li>Is <span class="math inline">\(X_j \leq c\)</span>? for all possible thresholds <span class="math inline">\(c\)</span>.</li>
<li>Split lines: parallel to the coordinates.</li>
</ul></li>
<li><p>Categorical variables, <span class="math inline">\(X_j \in \{1, 2, \ldots, M\}\)</span>:</p>
<ul>
<li>Is <span class="math inline">\(X_j \in A\)</span>?, where <span class="math inline">\(A \subseteq M\)</span> .</li>
</ul></li>
<li><p>The pool of candidate splits for all <span class="math inline">\(p\)</span> variables is formed by combining all the generated questions.</p></li>
</ul>
<!-- - Once we have the pool of candidate splits, the next step is to decide which one to use when constructing the decision tree. -->
</section>
<section id="tb-1.21---goodness-of-split" class="slide level2">
<h2>TB 1.21 - Goodness of Split</h2>
<ul>
<li><p>The way we choose the split, is <em>to measure every split by a ‘goodness of split’ measure</em>, which depends on:</p>
<ul>
<li>the split question as well as</li>
<li>the node to split.</li>
</ul></li>
<li><p>Goodness of split is measured by <em>impurity functions</em>.</p></li>
<li><p>Intuitively, when we split the points we want the region corresponding to each leaf node to be “pure”, that is, most points in this region come from the same class, that is, one class dominates.</p></li>
</ul>
</section>
<section id="tb-1.2.2---good-splits-vs-bad-splits" class="slide level2">
<h2>TB 1.2.2 - Good splits vs bad splits</h2>
<div class="columns">
<div class="fragment">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/BadSplit.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><em>Purity</em> not increased</p>
</div>
</div><div class="fragment">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="images/GoodSplit.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><em>Purity</em> increased</p>
</div>
</div>
</div>
</section>
<section id="tb-1.2.3---measuring-homogeneity" class="slide level2">
<h2>TB 1.2.3 - Measuring homogeneity</h2>
<ul>
<li><p>In order to measure homogeneity,or as called here, <em>purity</em>, of splits we introduce</p>
<ul>
<li>Impurity functions</li>
<li>Impurity measures</li>
</ul></li>
<li><p>Used to measure the extent of <em>purity</em> for a region containing data points from possibly different classes.</p></li>
</ul>
</section>
<section id="tb-1.2.4---impurity-functions" class="slide level2 scrollable">
<h2>TB 1.2.4 - Impurity functions</h2>
<div class="font80">
<p>An <strong>impurity function</strong> is a function <span class="math inline">\(\Phi\)</span> defined on the set of all <span class="math inline">\(K\)</span>-tuples of numbers <span class="math inline">\(\mathbf{p}= \left(p_{1}, \cdots, p_{K}\right)\)</span> s.t. <span class="math inline">\(p_{j} \geq 0, \,  \sum_{j=1}^K p_{j}=1\)</span>, <span class="math display">\[
\Phi: \left(p_{1}, \cdots, p_{K}\right) \rightarrow [0,1]
\]</span></p>
<p>with the properties:</p>
<ol type="1">
<li><span class="math inline">\(\Phi\)</span> achieves maximum only for the uniform distribution, that is all the <span class="math inline">\(p_{j}\)</span> are equal.</li>
<li><span class="math inline">\(\Phi\)</span> achieves minimum only at the points <span class="math inline">\((1,0, \ldots, 0)\)</span>,<span class="math inline">\((0,1,0, \ldots, 0)\)</span>, <span class="math inline">\(\ldots,(0,0, \ldots, 0,1)\)</span>, i.e., when the probability of being in a certain class is 1 and 0 for all the other classes.</li>
<li><span class="math inline">\(\Phi\)</span> is a symmetric function of <span class="math inline">\(p_{1}, \cdots, p_{K}\)</span>, i.e., if we permute <span class="math inline">\(p_{j}\)</span>, <span class="math inline">\(\Phi\)</span> remains constant.</li>
</ol>
</div>
</section>
<section id="tb-1.2.5---some-impurity-functions" class="slide level2">
<h2>TB 1.2.5 - Some Impurity Functions</h2>
<ul>
<li>The functions below are commonly used to measure impurity.</li>
</ul>
<!-- - Let $t$ be a node and $p(k|t)$ the conditional probability of observing class $k$ at that node. The node information function $i(t)$ may be defined as: -->
<div class="font80">
<ul>
<li><p><span class="math inline">\(\Phi_E (\mathbf{p}) = -\sum_{j=1}^K p_j\log (p_j)\)</span> (<strong>Entropy</strong>).</p></li>
<li><p><span class="math inline">\(\Phi_G (\mathbf{p}) = 1-\sum_{j=1}^K p_j^2\)</span>. (<strong>Gini Index</strong>).</p></li>
<li><p><span class="math inline">\(\Phi_M (\mathbf{p}) = \sum_{i=1}^K p_j(1-p_j)\)</span> (<strong>Misclassification rate</strong>).</p></li>
</ul>
</div>
<ul>
<li>In practice, for classification trees only the first two are recommended.</li>
</ul>
</section>
<section id="tb-1.2.5-impurity-functions-behavior" class="slide level2">
<h2>TB 1.2.5 Impurity functions behavior</h2>
<center>
<img data-src="images/impurity.jpg" style="width:65.0%">
</center>
<div class="tiny">
<p>Node impurity functions for the two-class case. - The entropy function (rescaled) is the red curve, the Gini index is the green curve, and the resubstitution estimate of the misclassification rate is the blue curve.</p>
</div>
</section>
<section id="tb-1.2.6---impurity-for-a-split" class="slide level2">
<h2>TB 1.2.6 - Impurity for a split</h2>
<ul>
<li>Given an impurity function <span class="math inline">\(\Phi\)</span>, a node <span class="math inline">\(t\)</span>, and given <span class="math inline">\(p(j \mid t)\)</span>, the estimated posterior probability of class <span class="math inline">\(j\)</span> given node <span class="math inline">\(t\)</span>, the <em>impurity measure of <span class="math inline">\(t\)</span></em>, <span class="math inline">\(i(t)\)</span>, is defined as:</li>
</ul>
<p><span class="math display">\[
i(t)=\phi(p(1 \mid t), p(2 \mid t), \ldots, p(K \mid t))
\]</span> - That is, the <em>impurity measure</em> of a split (or a node) is the impurity function when computed on probabilities associated (conditional) with a node.</p>
</section>
<section id="tb-1.2.7---goodness-of-a-split" class="slide level2">
<h2>TB 1.2.7 - Goodness of a split</h2>
<ul>
<li>Once we have defined <span class="math inline">\(i(t)\)</span>, we define the goodness of split <span class="math inline">\(s\)</span> for node <span class="math inline">\(t\)</span>, denoted by <span class="math inline">\(\Phi(s, t)\)</span> :</li>
</ul>
<p><span class="math display">\[
\Phi(s, t)=\Delta i(s, t)=i(t)-p_{R} i\left(t_{R}\right)-p_{L} i\left(t_{L}\right)
\]</span></p>
<ul>
<li>The best split for the single variable <span class="math inline">\(X_{j}\)</span> is the one that has the largest value of <span class="math inline">\(\Phi(s, t)\)</span> over all <span class="math inline">\(s \in \mathcal{S}_{j}\)</span>, the set of possible distinct splits for <span class="math inline">\(X_{j}\)</span>.</li>
</ul>
</section>
<section id="tb-1.2.8---impurity-score-for-a-node" class="slide level2">
<h2>TB 1.2.8 - Impurity score for a node</h2>
<ul>
<li><p>The impurity, <span class="math inline">\(i(t)\)</span>, of a node is based solely on the estimated posterior probabilities of the classes</p>
<ul>
<li>That is, <em>it doesn’t account for the size of <span class="math inline">\(t\)</span></em>.</li>
</ul></li>
<li><p>This is done by the <em>impurity score</em> of <span class="math inline">\(t\)</span>, defined as <span class="math inline">\(I(t)=i(t)\cdot p(t)\)</span>, a <em>weighted impurity measure</em> of node <span class="math inline">\(t\)</span> that takes into account:</p>
<ul>
<li><p>The estimated posterior probabilities of the classes,</p></li>
<li><p>The estimated proportion of data that go to node <span class="math inline">\(t\)</span>.</p></li>
</ul></li>
</ul>
</section>
<section id="tb-1.2.9---applications-of-it" class="slide level2">
<h2>TB 1.2.9 - Applications of <span class="math inline">\(I(t)\)</span></h2>
<ul>
<li><span class="math inline">\(I(t)\)</span> can be used to:
<ul>
<li>Define the aggregated impurity of a tree, by adding the impurity scores of all terminal leaves.</li>
<li>Provide a weighted measure of impurity decrease for a split: <span class="math inline">\(\Delta I(s, t)=p(t) \Delta i(s, t)\)</span>.</li>
<li>Define a criteria for stop splitting a tree (see below).</li>
</ul></li>
</ul>
</section>
<section id="tb-1.2.10---entropy-as-an-impurity-measure" class="slide level2">
<h2>TB 1.2.10 - Entropy as an impurity measure</h2>
<ul>
<li>The entropy of a node, <span class="math inline">\(t\)</span>, that is split in <span class="math inline">\(n\)</span> child nodes <span class="math inline">\(t_1\)</span>, <span class="math inline">\(t_2\)</span>, …, <span class="math inline">\(t_n\)</span>, is:</li>
</ul>
<p><span class="math display">\[
H(t)=-\sum_{i=1}^{n} P\left(t_{i}\right) \log _{2} P\left(t_{i}\right)
\]</span></p>
</section>
<section id="tb-1.2.11---goodness-of-split-based-on-entropy" class="slide level2">
<h2>TB 1.2.11 - Goodness of split based on entropy</h2>
<ul>
<li><p>From here, an information gain (that is impurity decrease) measure can be introduced.</p></li>
<li><p>Information theoretic approach that compares</p>
<ul>
<li>the entropy of the parent node before the split to</li>
<li>that of a weighted sum of the child nodes after the split where the weights are proportional to the number of observations in each node.</li>
</ul></li>
</ul>
</section>
<section id="tb-1.2.12---information-gain" class="slide level2">
<h2>TB 1.2.12 - Information gain</h2>
<ul>
<li>For a split <span class="math inline">\(s\)</span> and a set of observations (a node) <span class="math inline">\(t\)</span>, information gain is defined as:</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
&amp; IG(t, s)=\text { (original entr.) }-(\text { entr. after split) } \\
&amp; IG(t, s)=H(t)-\sum_{i=1}^{n} \frac{\left|t_{i}\right|}{t} H\left(x_{i}\right)
\end{aligned}
\]</span></p>
</section>
<section id="example" class="slide level2 smaller">
<h2>Example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Consider the problem of designing an algorithm to automatically differentiate between apples and pears (class labels) given only their width and height measurements (features).</p>
</div><div class="column" style="width:60%;">
<div class="font80">
<table>
<thead>
<tr class="header">
<th><strong>Width</strong></th>
<th><strong>Height</strong></th>
<th><strong>Fruit</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7.1</td>
<td>7.3</td>
<td>Apple</td>
</tr>
<tr class="even">
<td>7.9</td>
<td>7.5</td>
<td>Apple</td>
</tr>
<tr class="odd">
<td>7.4</td>
<td>7.0</td>
<td>Apple</td>
</tr>
<tr class="even">
<td>8.2</td>
<td>7.3</td>
<td>Apple</td>
</tr>
<tr class="odd">
<td>7.6</td>
<td>6.9</td>
<td>Apple</td>
</tr>
<tr class="even">
<td>7.8</td>
<td>8.0</td>
<td>Apple</td>
</tr>
<tr class="odd">
<td>7.0</td>
<td>7.5</td>
<td>Pear</td>
</tr>
<tr class="even">
<td>7.1</td>
<td>7.9</td>
<td>Pear</td>
</tr>
<tr class="odd">
<td>6.8</td>
<td>8.0</td>
<td>Pear</td>
</tr>
<tr class="even">
<td>6.6</td>
<td>7.7</td>
<td>Pear</td>
</tr>
<tr class="odd">
<td>7.3</td>
<td>8.2</td>
<td>Pear</td>
</tr>
<tr class="even">
<td>7.2</td>
<td>7.9</td>
<td>Pear</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="example.-entropy-calculation" class="slide level2">
<h2>Example. Entropy Calculation</h2>

<img data-src="images/Example2-EntropyCalculation.png" style="width:100.0%" class="r-stretch"></section>
<section id="example.-information-gain" class="slide level2">
<h2>Example. Information Gain</h2>

<img data-src="images/Example2-IGCalculation.png" style="width:100.0%" class="r-stretch"></section></section>
<section>
<section id="prediction-with-trees" class="title-slide slide level1 center">
<h1>Prediction with Trees</h1>

</section>
<section id="tb-2---class-assignment" class="slide level2">
<h2>TB 2 - Class Assignment</h2>
<ul>
<li><p>The decision tree classifies new data points as follows.</p>
<ul>
<li><p>We let a data point pass down the tree and see which leaf node it lands in.</p></li>
<li><p>The class of the leaf node is assigned to the new data point. Basically, all the points that land in the same leaf node will be given the same class.</p></li>
<li><p>This is similar to k-means or any prototype method.</p></li>
</ul></li>
</ul>
</section>
<section id="tb-2.1---class-assignment-rules" class="slide level2">
<h2>TB 2.1 - Class Assignment Rules</h2>
<ul>
<li>A class assignment rule assigns a class <span class="math inline">\(j=1, \cdots, K\)</span> to every terminal (leaf) node <span class="math inline">\(t \in \tilde{T}\)</span>.</li>
<li>The class is assigned to node <span class="math inline">\(t\)</span> is denoted by <span class="math inline">\(\kappa(t)\)</span>,
<ul>
<li>E.g., if <span class="math inline">\(\kappa(t)=2\)</span>, all the points in node <span class="math inline">\(t\)</span> would be assigned to class 2.</li>
</ul></li>
<li>If we use 0-1 loss, the class assignment rule picks the class with maximum posterior probability:</li>
</ul>
<p><span class="math display">\[
\kappa(t)=\arg \max _{j} p(j \mid t)
\]</span></p>
</section>
<section id="tb-2.2.-estimating-the-error-rate-1" class="slide level2">
<h2>TB 2.2. Estimating the error rate (1)</h2>
<ul>
<li><p>Let’s assume we have built a tree and have the classes assigned for the leaf nodes.</p></li>
<li><p>Goal: estimate <em>the classification error rate</em> for this tree.</p></li>
<li><p>We use the <em>resubstitution estimate <span class="math inline">\(r(t)\)</span> for the probability of misclassification, given that a case falls into node <span class="math inline">\(t\)</span></em>. This is:</p></li>
</ul>
<p><span class="math display">\[
r(t)=1-\max _{j} p(j \mid t)=1-p(\kappa(t) \mid t)
\]</span></p>
</section>
<section id="tb-2.3.-estimating-the-error-rate-2" class="slide level2">
<h2>TB 2.3. Estimating the error rate (2)</h2>
<ul>
<li><p>Denote <span class="math inline">\(R(t)=r(t) p(t)\)</span>, that is the miscclassification error rate weighted by the probability of the node.</p></li>
<li><p>The resubstitution estimation for the overall misclassification rate <span class="math inline">\(R(T)\)</span> of the tree classifier <span class="math inline">\(T\)</span> is:</p></li>
</ul>
<p><span class="math display">\[
R(T)=\sum_{t \in \tilde{T}} R(t)
\]</span></p>
</section></section>
<section>
<section id="obtaining-best-trees" class="title-slide slide level1 center">
<h1>Obtaining best trees</h1>

</section>
<section id="tb.-3.1---when-to-stop-growing" class="slide level2">
<h2>TB. 3.1 - When to stop growing</h2>
<ul>
<li><p>Maximizing information gain is one possible criteria to choose among splits.</p></li>
<li><p>In order to avoid excessive complexity it is usually decided to stop splitting when <em>information gain does not compensate for increase in complexity</em>.</p></li>
</ul>
</section>
<section id="tb-3.2-stop-splitting-criteria" class="slide level2">
<h2>TB 3.2 Stop splitting criteria</h2>
<ul>
<li>In practice, stop splitting is decided when: <span class="math display">\[
\max _{s \in S} \Delta I(s, t)&lt;\beta,
\]</span>where:
<ul>
<li><span class="math inline">\(\Delta I\)</span> represents the information gain associated with an optimal split <span class="math inline">\(s\)</span> and a node <span class="math inline">\(t\)</span>,</li>
<li>and <span class="math inline">\(\beta\)</span> is a pre-determined threshold.</li>
</ul></li>
</ul>
</section>
<section id="tb-3.3-optimizing-the-tree" class="slide level2">
<h2>TB 3.3 Optimizing the Tree</h2>
<ul>
<li><p>Trees obtained by looking for optimal splits tend to overfit: good for the data in the tree, but generalize badly and tend to fail more in predictions.</p></li>
<li><p>In order to reduce complexity and overfitting,<br> while keeping the tree as good as possible, tree <em>pruning</em> may be applied.</p></li>
<li><p>Pruning works <em>removing branches that are unlikely to improve the accuracy</em> of the model on new data.</p></li>
</ul>
</section>
<section id="tb-3.4-pruning-methods" class="slide level2">
<h2>TB 3.4 Pruning methods</h2>
<ul>
<li>There are different pruning methods, but the most common one is the <em>cost-complexity</em> pruning algorithm, also known as the <em>weakest link pruning</em>.</li>
<li>The algorithm works by adding a penalty term to the misclassification rate of the terminal nodes:</li>
</ul>
<p><span class="math display">\[
R_\alpha(T) =R(T)+\alpha|T|
\]</span> where <span class="math inline">\(\alpha\)</span> is the parameter that controls the trade-off between tree complexity and accuracy.</p>
</section>
<section id="tb-3.5-cost-complexity-pruning" class="slide level2">
<h2>TB 3.5 Cost complexity pruning</h2>
<ul>
<li><p>Start by building a large tree that overfits the data.</p></li>
<li><p>Then, use cross-validation to estimate the optimal value of alpha that minimizes the generalization error.</p></li>
<li><p>Finally, prune the tree by removing the branches that have a smaller improvement in impurity than the penalty term multiplied by alpha.</p></li>
<li><p>Iterate the process until no more branches can be pruned, or until a minimum tree size is reached.</p></li>
</ul>
</section></section>
<section>
<section id="regression-trees" class="title-slide slide level1 center">
<h1>Regression Trees</h1>

</section>
<section id="regression-modelling-with-trees" class="slide level2">
<h2>Regression modelling with trees</h2>
<ul>
<li><p>When the response variable is numeric, decision trees are <em>regression trees</em>.</p></li>
<li><p>Option of choice for distinct reasons</p>
<ul>
<li>The relation between response and potential explanatory variables is not linear.</li>
<li>Perform automatic variable selection.</li>
<li>Easy to interpret, visualize, explain.</li>
<li>Robust to outliers and can handle missing data</li>
</ul></li>
</ul>
</section>
<section id="classification-vs-regression-trees" class="slide level2">
<h2>Classification vs Regression Trees</h2>
<div class="font50">
<table>
<colgroup>
<col style="width: 25%">
<col style="width: 37%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Aspect</strong></th>
<th style="text-align: left;"><strong>Regression Trees</strong></th>
<th style="text-align: left;"><strong>Classification Trees</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Outcome var. type</td>
<td style="text-align: left;">Continuous</td>
<td style="text-align: left;">Categorical</td>
</tr>
<tr class="even">
<td style="text-align: left;">Goal</td>
<td style="text-align: left;">To predict a numerical value</td>
<td style="text-align: left;">To predict a class label</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Splitting criteria</td>
<td style="text-align: left;">Mean Squared Error, Mean Abs. Error</td>
<td style="text-align: left;">Gini Impurity, Entropy, etc.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Leaf node prediction</td>
<td style="text-align: left;">Mean or median of the target variable in that region</td>
<td style="text-align: left;">Mode or majority class of the target variable ...</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Examples of use cases</td>
<td style="text-align: left;">Predicting housing prices, predicting stock prices</td>
<td style="text-align: left;">Predicting customer churn, predicting high/low risk in diease</td>
</tr>
<tr class="even">
<td style="text-align: left;">Evaluation metric</td>
<td style="text-align: left;">Mean Squared Error, Mean Absolute Error, R-square</td>
<td style="text-align: left;">Accuracy, Precision, Recall, F1-score, etc.</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="regression-tree-example" class="slide level2">
<h2>Regression tree example</h2>
<ul>
<li>The <code>airquality</code> dataset from the <code>datasets</code> package contains daily air quality measurements in New York from May through September of 1973 (153 days).</li>
<li>The main variables include:
<ul>
<li>Ozone: the mean ozone (in parts per billion) …</li>
<li>Solar.R: the solar radiation (in Langleys) …</li>
<li>Wind: the average wind speed (in mph) …</li>
<li>Temp: the maximum daily temperature (ºF) …</li>
</ul></li>
<li>Main goal : Predict ozone concentration.</li>
</ul>
</section>
<section id="non-linear-relationships" class="slide level2 smaller">
<h2>Non linear relationships!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a>aq <span class="ot">&lt;-</span> datasets<span class="sc">::</span>airquality</span>
<span id="cb10-2"><a href=""></a>color <span class="ot">&lt;-</span> <span class="fu">adjustcolor</span>(<span class="st">"forestgreen"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>)</span>
<span id="cb10-3"><a href=""></a>ps <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, ...) {  <span class="co"># custom panel function</span></span>
<span id="cb10-4"><a href=""></a>  <span class="fu">panel.smooth</span>(x, y, <span class="at">col =</span> color, <span class="at">col.smooth =</span> <span class="st">"black"</span>, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb10-5"><a href=""></a>}</span>
<span id="cb10-6"><a href=""></a><span class="fu">pairs</span>(aq, <span class="at">cex =</span> <span class="fl">0.7</span>, <span class="at">upper.panel =</span> ps, <span class="at">col =</span> color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="1.1-DecisionTrees-Slides_files/figure-revealjs/unnamed-chunk-21-1.png" class="quarto-figure quarto-figure-center r-stretch" width="960"></section>
<section id="building-the-tree-1-splitting" class="slide level2">
<h2>Building the tree (1): Splitting</h2>
<div class="font80">
<ul>
<li>Consider:
<ul>
<li>all predictors <span class="math inline">\(X_1, \dots, X_n\)</span>, and</li>
<li>all values of cutpoint <span class="math inline">\(s\)</span> for each predictor and</li>
</ul></li>
<li>For each predictor find boxes <span class="math inline">\(R_1, \ldots, R_J\)</span> that minimize the RSS, given by:</li>
</ul>
<p><span class="math display">\[
\sum_{j=1}^J \sum_{i \in R_j}\left(y_i-\hat{y}_{R_j}\right)^2
\]</span></p>
<p>where <span class="math inline">\(\hat{y}_{R_j}\)</span> is the mean response for the training observations within the <span class="math inline">\(j\)</span> th box.</p>
</div>
</section>
<section id="building-the-tree-2-splitting" class="slide level2">
<h2>Building the tree (2): Splitting</h2>
<div class="font80">
<ul>
<li>To do this, define the pair of half-planes</li>
</ul>
<p><span class="math display">\[
R_1(j, s)=\left\{X \mid X_j&lt;s\right\} \text { and } R_2(j, s)=\left\{X \mid X_j \geq s\right\}
\]</span></p>
<p>and seek the value of <span class="math inline">\(j\)</span> and <span class="math inline">\(s\)</span> that minimize the equation:</p>
<p><span class="math display">\[
\sum_{i: x_i \in R_1(j, s)}\left(y_i-\hat{y}_{R_1}\right)^2+\sum_{i: x_i \in R_2(j, s)}\left(y_i-\hat{y}_{R_2}\right)^2.
\]</span></p>
</div>
</section>
<section id="building-the-tree-3-prediction" class="slide level2 smaller">
<h2>Building the tree (3): Prediction</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li><p>Once the regions have been created we predict the response using the mean of the trainig observations <em>in the region to which that observation belongs</em>.</p></li>
<li><p>In the example, for an observation belonging to the shaded region, the prediction would be:</p></li>
</ul>
<p><span class="math display">\[
\hat{y} =\frac{1}{4}(y_2+y_3+y_5+y_9)
\]</span></p>
</div><div class="column" style="width:60%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/RegressionTree-Prediction1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="example-a-regression-tree" class="slide level2">
<h2>Example: A regression tree</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb11-2"><a href=""></a>train <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(aq), <span class="at">size =</span> <span class="fu">nrow</span>(aq)<span class="sc">*</span><span class="fl">0.7</span>)</span>
<span id="cb11-3"><a href=""></a>aq_train <span class="ot">&lt;-</span> aq[train,]</span>
<span id="cb11-4"><a href=""></a>aq_test  <span class="ot">&lt;-</span> aq[<span class="sc">-</span>train,]</span>
<span id="cb11-5"><a href=""></a>aq_regresion <span class="ot">&lt;-</span> tree<span class="sc">::</span><span class="fu">tree</span>(<span class="at">formula =</span> Ozone <span class="sc">~</span> ., </span>
<span id="cb11-6"><a href=""></a>                           <span class="at">data =</span> aq_train, <span class="at">split =</span> <span class="st">"deviance"</span>)</span>
<span id="cb11-7"><a href=""></a><span class="fu">summary</span>(aq_regresion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression tree:
tree::tree(formula = Ozone ~ ., data = aq_train, split = "deviance")
Variables actually used in tree construction:
[1] "Temp"    "Wind"    "Solar.R" "Day"    
Number of terminal nodes:  8 
Residual mean deviance:  285.6 = 21420 / 75 
Distribution of residuals:
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-58.2000  -7.9710  -0.4545   0.0000   5.5290  81.8000 </code></pre>
</div>
</div>
</section>
<section id="example-plot-the-tree" class="slide level2">
<h2>Example: Plot the tree</h2>

<img data-src="1.1-DecisionTrees-Slides_files/figure-revealjs/unnamed-chunk-24-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="error-estimation-and-optimization-for-regression-trees" class="title-slide slide level1 center">
<h1>Error estimation and optimization for regression trees</h1>

</section>
<section id="prunning-the-tree-1" class="slide level2">
<h2>Prunning the tree (1)</h2>
<ul>
<li>As before, <em>cost-complexity prunning</em> can be applied</li>
<li>We consider a sequence of trees indexed by a nonnegative tuning parameter <span class="math inline">\(\alpha\)</span>.</li>
<li>For each value of <span class="math inline">\(\alpha\)</span> there corresponds a subtree <span class="math inline">\(T \subset T_0\)</span> such that:</li>
</ul>
<div class="font80">
<p><span class="math display">\[
\sum_{m=1}^{|T|} \sum_{y_i \in R_m}
\left(y_i -\hat{y}_{R_m}\right)^2+
\alpha|T|\quad (*)
\label{prunning}
\]</span></p>
</div>
<p>is as small as possible.</p>
</section>
<section id="tuning-parameter-alpha" class="slide level2">
<h2>Tuning parameter <span class="math inline">\(\alpha\)</span></h2>
<ul>
<li><span class="math inline">\(\alpha\)</span> controls a trade-off between the subtree’s complexity and its fit to the training data.</li>
<li>When <span class="math inline">\(\alpha=0\)</span>, then the subtree <span class="math inline">\(T\)</span> will simply equal <span class="math inline">\(T_0\)</span>.</li>
<li>As <span class="math inline">\(\alpha\)</span> increases, there is a price to pay for having a tree with many terminal nodes, and so (*) will tend to be minimized for a smaller subtree.</li>
<li>Equation (*1) is reminiscent of the lasso.</li>
<li><span class="math inline">\(\alpha\)</span> can be chosen by cross-validation .</li>
</ul>
</section>
<section id="optimizing-the-tree-alpha" class="slide level2 smaller scrollable">
<h2>Optimizing the tree (<span class="math inline">\(\alpha\)</span>)</h2>
<ol type="1">
<li><p>Use recursive binary splitting to grow a large tree on the training data, stopping only when each terminal node has fewer than some minimum number of observations.</p></li>
<li><p>Apply cost complexity pruning to the large tree in order to obtain a sequence of best subtrees, as a function of <span class="math inline">\(\alpha\)</span>.</p></li>
<li><p>Use K-fold cross-validation to choose <span class="math inline">\(\alpha\)</span>. That is, divide the training observations into <span class="math inline">\(K\)</span> folds. For each <span class="math inline">\(k=1, \ldots, K\)</span> :</p>
<ol type="1">
<li>Repeat Steps 1 and 2 on all but the <span class="math inline">\(k\)</span> th fold of the training data.</li>
<li>Evaluate the mean squared prediction error on the data in the left-out <span class="math inline">\(k\)</span> th fold, as a function of <span class="math inline">\(\alpha\)</span>.</li>
</ol></li>
</ol>
<p>Average the results for each value of <span class="math inline">\(\alpha\)</span>. Pick <span class="math inline">\(\alpha\)</span> to minimize the average error.</p>
<ol start="4" type="1">
<li>Return the subtree from Step 2 that corresponds to the chosen value of <span class="math inline">\(\alpha\)</span>.</li>
</ol>
</section>
<section id="example-prune-the-tree" class="slide level2">
<h2>Example: Prune the tree</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>cv_aq <span class="ot">&lt;-</span> tree<span class="sc">::</span><span class="fu">cv.tree</span>(aq_regresion, <span class="at">K =</span> <span class="dv">5</span>)</span>
<span id="cb13-2"><a href=""></a>optimal_size <span class="ot">&lt;-</span>  <span class="fu">rev</span>(cv_aq<span class="sc">$</span>size)[<span class="fu">which.min</span>(<span class="fu">rev</span>(cv_aq<span class="sc">$</span>dev))]</span>
<span id="cb13-3"><a href=""></a>aq_final_tree <span class="ot">&lt;-</span> tree<span class="sc">::</span><span class="fu">prune.tree</span>(</span>
<span id="cb13-4"><a href=""></a>                 <span class="at">tree =</span> aq_regresion,</span>
<span id="cb13-5"><a href=""></a>                 <span class="at">best =</span> optimal_size</span>
<span id="cb13-6"><a href=""></a>               )</span>
<span id="cb13-7"><a href=""></a><span class="fu">summary</span>(aq_final_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression tree:
tree::tree(formula = Ozone ~ ., data = aq_train, split = "deviance")
Variables actually used in tree construction:
[1] "Temp"    "Wind"    "Solar.R" "Day"    
Number of terminal nodes:  8 
Residual mean deviance:  285.6 = 21420 / 75 
Distribution of residuals:
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-58.2000  -7.9710  -0.4545   0.0000   5.5290  81.8000 </code></pre>
</div>
</div>
<p>In this example pruning does not improve the tree.</p>
</section></section>
<section>
<section id="advantages-and-disadvantages-of-trees" class="title-slide slide level1 center">
<h1>Advantages and disadvantages of trees</h1>

</section>
<section id="trees-have-many-advantages" class="slide level2">
<h2>Trees have many advantages</h2>
<ul>
<li><p>Trees are very easy to explain to people.</p></li>
<li><p>Decision trees may be seen as good mirrors of human decision-making.</p></li>
<li><p>Trees can be displayed graphically, and are easily interpreted even by a non-expert.</p></li>
<li><p>Trees can easily handle qualitative predictors without the need to create dummy variables.</p></li>
</ul>
</section>
<section id="but-they-come-at-a-price" class="slide level2">
<h2>But they come at a price</h2>
<ul>
<li><p>Trees generally do not have the same level of predictive accuracy as sorne of the other regression and classification approaches.</p></li>
<li><p>Additionally, trees can be very non-robust: a small change in the data can cause a large change in the final estimated tree.</p></li>
</ul>
</section></section>
<section>
<section id="references-and-resources" class="title-slide slide level1 center">
<h1>References and Resources</h1>

</section>
<section id="references" class="slide level2 smaller">
<h2>References</h2>
<ul>
<li><p><a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/decisionForests_MSR_TR_2011_114.pdf">A. Criminisi, J. Shotton and E. Konukoglu (2011) Decision Forests for Classifcation, Regression … Microsoft Research technical report TR-2011-114</a></p></li>
<li><p>Efron, B., Hastie T. (2016) Computer Age Statistical Inference. Cambridge University Press. <a href="https://hastie.su.domains/CASI/index.html">Web site</a></p></li>
<li><p>Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). The elements of statistical learning: Data mining, inference, and prediction. Springer.</p></li>
<li><p>James, G., Witten, D., Hastie, T., &amp; Tibshirani, R. (2013). An introduction to statistical learning (Vol. 112). Springer. <a href="https://www.statlearning.com/">Web site</a></p></li>
</ul>
</section>
<section id="complementary-references" class="slide level2">
<h2>Complementary references</h2>
<ul>
<li><p>Breiman, L., Friedman, J., Stone, C. J., &amp; Olshen, R. A. (1984). Classification and regression trees. CRC press.</p></li>
<li><p>Brandon M. Greenwell (202) Tree-Based Methods for Statistical Learning in R. 1st Edition. Chapman and Hall/CRC DOI: https://doi.org/10.1201/9781003089032</p></li>
<li><p>Genuer R., Poggi, J.M. (2020) Random Forests with R. Springer ed.&nbsp;(UseR!)</p></li>
</ul>
</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<ul>
<li><p><a href="https://online.stat.psu.edu/stat508/">Applied Data Mining and Statistical Learning (Penn Statte-University)</a></p></li>
<li><p><a href="https://daviddalpiaz.github.io/r4sl/">R for statistical learning</a></p></li>
<li><p><a href="http://www.sthda.com/english/articles/35-statistical-machine-learning-essentials/141-cart-model-decision-tree-essentials/#example-of-data-set">CART Model: Decision Tree Essentials</a></p></li>
<li><p><a href="https://cran.r-project.org/web/packages/rpart/vignettes/longintro.pdf">An Introduction to Recursive Partitioning Using the RPART Routines</a></p></li>
</ul>
<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="1.1-DecisionTrees-Slides_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true,"width":"half","numbers":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>